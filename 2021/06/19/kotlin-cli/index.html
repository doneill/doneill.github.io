<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Automating things via command line tools is awesome and after doing some experimenting with Kotlin as a modern programming language for cli applications and inspired by the kotlin cli starter repo I w">
<meta property="og:type" content="article">
<meta property="og:title" content="Kotlin CLI">
<meta property="og:url" content="http://gh.jdoneill.com/2021/06/19/kotlin-cli/index.html">
<meta property="og:site_name" content="jdONeill">
<meta property="og:description" content="Automating things via command line tools is awesome and after doing some experimenting with Kotlin as a modern programming language for cli applications and inspired by the kotlin cli starter repo I w">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://gh.jdoneill.com/2021/06/19/kotlin-cli/app-structure.png">
<meta property="article:published_time" content="2021-06-19T18:18:25.000Z">
<meta property="article:modified_time" content="2021-06-19T18:18:25.000Z">
<meta property="article:author" content="jdONeill">
<meta property="article:tag" content="kotlin">
<meta property="article:tag" content="clikt">
<meta property="article:tag" content="coroutines">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://gh.jdoneill.com/2021/06/19/kotlin-cli/app-structure.png">
    
    
    <!-- title -->
    <title>Kotlin CLI</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- Leaflet -->
    
      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
      <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    
    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="jdONeill" type="application/atom+xml" />
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/gallery/">Gallery</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2021/06/13/koop-vector-tile/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://gh.jdoneill.com/2021/06/19/kotlin-cli/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&text=Kotlin CLI"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&title=Kotlin CLI"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&is_video=false&description=Kotlin CLI"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Kotlin CLI&body=Check out this article: http://gh.jdoneill.com/2021/06/19/kotlin-cli/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&title=Kotlin CLI"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&title=Kotlin CLI"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&title=Kotlin CLI"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&title=Kotlin CLI"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&name=Kotlin CLI&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&t=Kotlin CLI"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Create-a-single-module-Gradle-project"><span class="toc-number">1.</span> <span class="toc-text">Create a single module Gradle project</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dependencies"><span class="toc-number">2.</span> <span class="toc-text">Dependencies</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Asynchronous-Command-Line-Iterface-for-Kotlin"><span class="toc-number">2.1.</span> <span class="toc-text">Asynchronous Command Line Iterface for Kotlin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Demo-CLI-App"><span class="toc-number">3.</span> <span class="toc-text">Demo CLI App</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Run-the-app"><span class="toc-number">4.</span> <span class="toc-text">Run the app</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Kotlin CLI
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">jdONeill</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2021-06-19T18:18:25.000Z" itemprop="datePublished">2021-06-19</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/clikt/" rel="tag">clikt</a>, <a class="tag-link-link" href="/tags/coroutines/" rel="tag">coroutines</a>, <a class="tag-link-link" href="/tags/kotlin/" rel="tag">kotlin</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>Automating things via command line tools is awesome and after doing some experimenting with Kotlin as a modern programming language for cli applications and inspired by the <a target="_blank" rel="noopener" href="https://github.com/jmfayard/kotlin-cli-starter">kotlin cli starter repo</a> I wanted to break down creating the cli application from scratch using <a target="_blank" rel="noopener" href="https://ajalt.github.io/clikt/">CLIKT</a> and <a target="_blank" rel="noopener" href="https://kotlinlang.org/docs/coroutines-overview.html">Coroutines</a>.</p>
<h2 id="Create-a-single-module-Gradle-project"><a href="#Create-a-single-module-Gradle-project" class="headerlink" title="Create a single module Gradle project"></a>Create a single module Gradle project</h2><p>Create a project folder and skaffold it a Gradle application project:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create your poject directory</span></span><br><span class="line">$ mkdir demo</span><br><span class="line"></span><br><span class="line"><span class="comment"># initialize it with Gradle project structure</span></span><br><span class="line">$ <span class="built_in">cd</span> demo &amp;&amp; gradle init</span><br></pre></td></tr></table></figure>

<p>Choose the following project settings when prompted:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># select 2 application project</span></span><br><span class="line">Select <span class="built_in">type</span> of project to generate:</span><br><span class="line">  1: basic</span><br><span class="line">  2: application</span><br><span class="line">  3: library</span><br><span class="line">  4: Gradle plugin</span><br><span class="line">Enter selection (default: basic) [1..4] 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># Kotlin implementation language</span></span><br><span class="line">Select implementation language:</span><br><span class="line">  1: C++</span><br><span class="line">  2: Groovy</span><br><span class="line">  3: Java</span><br><span class="line">  4: Kotlin</span><br><span class="line">  5: Scala</span><br><span class="line">  6: Swift</span><br><span class="line">Enter selection (default: Java) [1..6] 4</span><br><span class="line"></span><br><span class="line"><span class="comment"># simple on application project</span></span><br><span class="line">Split functionality across multiple subprojects?:</span><br><span class="line">  1: no - only one application project</span><br><span class="line">  2: yes - application and library projects</span><br><span class="line">Enter selection (default: no - only one application project) [1..2] 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># kotlin dsl</span></span><br><span class="line">Select build script DSL:</span><br><span class="line">  1: Groovy</span><br><span class="line">  2: Kotlin</span><br><span class="line">Enter selection (default: Kotlin) [1..2] 2</span><br></pre></td></tr></table></figure>

<p>Now we have an empty application project. Let’s clean it up a bit.  The application structure created a single module project, we can remove the module and use the root projct as the module source:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># move the build script to root project</span></span><br><span class="line">$ mv app/build.gradle.kts build.gradle.kts</span><br><span class="line"><span class="comment"># remove app module, use project root as module source</span></span><br><span class="line">$ mv app/src src &amp;&amp; rm -rf app</span><br></pre></td></tr></table></figure>

<p>Open <code>settings.gradle.kts</code> and remove the module reference <code>include(&quot;app&quot;)</code>. Your app directory structure should look simiilar to the following:</p>
<p align="rigth">
    <img align="left" width="300" height="244" src="app-structure.png">
</p>

<h2 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h2><p>A common way to manage gradle dependencies is to have an <code>ext&#123;&#125;</code> block in your root project.  This doesn’t provide any code completion or code navigation, in order to suppport those features we will define dependencies as String constants in <code>Dependencies.kt</code> inside of <code>buildSrc</code> folder.  The directory <code>buildSrc</code> is treated as an included build where Gradle automatically compiles its sources.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># make a buildSrc directory and source package structure</span></span><br><span class="line">$ mkdir -p buildSrc/&#123;src/&#123;main/&#123;kotlin,&#125;,&#125;,&#125;</span><br><span class="line"><span class="comment"># create Dependencies.kt</span></span><br><span class="line">$ touch buildSrc/src/main/kotlin/Dependencies.kt</span><br></pre></td></tr></table></figure>

<p>Now we need to create a build script for our Dependencies</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ touch buildSrc/build.gradle.kts</span><br></pre></td></tr></table></figure>

<p>Open the new <code>build.gradle.kts</code> file and add the following:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    `kotlin-dsl`</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Asynchronous-Command-Line-Iterface-for-Kotlin"><a href="#Asynchronous-Command-Line-Iterface-for-Kotlin" class="headerlink" title="Asynchronous Command Line Iterface for Kotlin"></a>Asynchronous Command Line Iterface for Kotlin</h3><p>We will use <code>CLIKT</code> multiplatform library which makes writing cli apps easy and <code>Coroutines</code> for an asynchronous, or non-blocking, application. Open <code>buildSrc/src/main/kotlin/Dependencies.kt</code> file to add the following dependencies and versions:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> Versions &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">val</span> CLIKT = <span class="string">&quot;3.2.0&quot;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">val</span> COROUTINES = <span class="string">&quot;1.5.0&quot;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">val</span> JVM = <span class="string">&quot;1.8&quot;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">val</span> KOTLIN = <span class="string">&quot;1.4.32&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> Clikt &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">val</span> CLIKT = <span class="string">&quot;com.github.ajalt.clikt:clikt:<span class="subst">$&#123;Versions.CLIKT&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> Coroutines &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">val</span> CORE = <span class="string">&quot;org.jetbrains.kotlinx:kotlinx-coroutines-core:<span class="subst">$&#123;Versions.COROUTINES&#125;</span>&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now we can access these in our applications build script.  Open the root <code>build.gradle.kts</code> file to add the dependencies and do some version updates:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add to the dependencies block</span></span><br><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// clikt</span></span><br><span class="line">    implementation(Clikt.CLIKT)</span><br><span class="line">    <span class="comment">// coroutines</span></span><br><span class="line">    implementation(Coroutines.CORE)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Optionally, we can update our kotlin version</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// update plugins block</span></span><br><span class="line">plugins &#123;</span><br><span class="line">    application</span><br><span class="line">    kotlin(<span class="string">&quot;jvm&quot;</span>) version Versions.KOTLIN</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Once you start using <code>buildSrc</code> for dependencies you can update many more build script definitions.</p>
<h2 id="Demo-CLI-App"><a href="#Demo-CLI-App" class="headerlink" title="Demo CLI App"></a>Demo CLI App</h2><p>Now that our project structure is complete we can start build our cli application.  We will reate a <code>cli</code> package for our source code and create the following classes/objects:</p>
<ul>
<li>Main.kt: Our application entry</li>
<li>Demo.kt: Our suspendable computation</li>
<li>DemoConfig.kt: Our applications configurations</li>
<li>DemoCommand.kt: Our applications teminal commands</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create package directory</span></span><br><span class="line">$ mkdir src/main/kotlin/cli &amp;&amp; touch src/main/kotlin/cli/Main.kt src/main/kotlin/cli/Demo.kt src/main/kotlin/cli/DemoConfig.kt src/main/kotlin/cli/DemoCommand.kt</span><br></pre></td></tr></table></figure>

<p>The <code>DemoConfig.kt</code> is a utility to house some globals, for now we will use to to reference our app command name. Open <code>DemoConfig.kt</code> to and add the following:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cli</span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> DemoConfig &#123;</span><br><span class="line">    <span class="keyword">val</span> COMMAND_NAME = <span class="string">&quot;demo&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>DemoCommand.kt</code> is a subclass of <a target="_blank" rel="noopener" href="https://ajalt.github.io/clikt/api/clikt/com.github.ajalt.clikt.core/-clikt-command/">CliktCommand</a>.  We will set it up with our help page and support for verbose output.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoCommand</span>: <span class="type">CliktCommand</span></span>(</span><br><span class="line">    help = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">       Demo API CLI.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>.trimIndent(),</span><br><span class="line">    epilog = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Try it with a demo type</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Examples:</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;COMMAND_NAME&#125;</span> hello</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>.trimIndent(),</span><br><span class="line">    name = COMMAND_NAME</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        completionOption()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> help: <span class="built_in">Boolean</span> <span class="keyword">by</span> option(<span class="string">&quot;-h&quot;</span>, <span class="string">&quot;--help&quot;</span>, help = <span class="string">&quot;Display this help screen&quot;</span>).flag()</span><br><span class="line">    <span class="keyword">val</span> verbose <span class="keyword">by</span> option(<span class="string">&quot;-v&quot;</span>, <span class="string">&quot;--verbose&quot;</span>, help = <span class="string">&quot;verbose&quot;</span>).flag(defaultForHelp = <span class="string">&quot;disabled&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (verbose) println(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>Demo.kt</code> will have our asynchronous methods to do work, to start we look <code>help</code> in the <code>args</code> passed to the application.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cli</span><br><span class="line"></span><br><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">runDemo</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> command = DemoCommand()</span><br><span class="line"></span><br><span class="line">    command.main(args)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (command.help) &#123;</span><br><span class="line">        println(command.getFormattedHelp())</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>Main.kt</code> will be our application entry point.  We will run the app in a new coroutine that blocks the current thread until its completion.  <code>runBlocking</code> is designed to bridge blocking code to suspending <code>runDemo</code> function.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cli</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> kotlinx.coroutines.runBlocking</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    runBlocking &#123; runDemo(args) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>With our source code ready we need to define our applications entry point.  We can do this by defining our application entry class.  Following our <code>buildSrc</code> pattern we can create a new class to source our application configuration:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create Coordinates.kt in buildSrc</span></span><br><span class="line">$ touch buildSrc/src/main/kotlin/Coordinates.kt</span><br></pre></td></tr></table></figure>

<p>Open the newly created <code>Coordinates.kt</code> file and add some application configruateions:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> AppCoordinates &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">val</span> APP_ID = <span class="string">&quot;cli.MainKt&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">val</span> APP_VERSION_NAME = <span class="string">&quot;0.0.1&quot;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">val</span> APP_VERSION_CODE = <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now we can reference the <code>APP_ID</code> as the main class for our application in the root <code>build.gradle.kts</code> build script, open it and add the following:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">application &#123;</span><br><span class="line">    mainClass.<span class="keyword">set</span>(AppCoordinates.APP_ID)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Run-the-app"><a href="#Run-the-app" class="headerlink" title="Run the app"></a>Run the app</h2><p>At this point the application can be assembled and distributed.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># build the app</span></span><br><span class="line">$ ./gradlew assemble</span><br><span class="line"><span class="comment"># build a distribution</span></span><br><span class="line">$ ./gradlew installDist</span><br></pre></td></tr></table></figure>

<p>This will generate an executable in <code>build/install/demo/bin/demo</code>.  We can create a run script at the root of the project to expedite and run the application from project root.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create a run script</span></span><br><span class="line">$ touch demo &amp;&amp; chmod 755 demo</span><br></pre></td></tr></table></figure>

<p>Open <code>demo</code> and add the following:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">./gradlew --quiet <span class="string">&quot;installDist&quot;</span> &amp;&amp; <span class="string">&quot;build/install/demo/bin/demo&quot;</span> <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>Now we can run <code>./demo --help</code> to see our help page defined in <code>DemoCommand.kt</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Usage: demo [OPTIONS]</span><br><span class="line"></span><br><span class="line">  Demo API CLI.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  --generate-completion [bash|zsh|fish]</span><br><span class="line">  -h, --<span class="built_in">help</span>                       Display this <span class="built_in">help</span> screen</span><br><span class="line">  -v, --verbose                    verbose</span><br><span class="line"></span><br><span class="line">Try it with a demo <span class="built_in">type</span></span><br><span class="line"></span><br><span class="line">Examples: Demo hello</span><br></pre></td></tr></table></figure>

<p>And with that we have successfully skaffold a Kotlin cli application using <code>Clikt</code> and <code>Coroutines</code>, happy coding!</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/gallery/">Gallery</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Create-a-single-module-Gradle-project"><span class="toc-number">1.</span> <span class="toc-text">Create a single module Gradle project</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dependencies"><span class="toc-number">2.</span> <span class="toc-text">Dependencies</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Asynchronous-Command-Line-Iterface-for-Kotlin"><span class="toc-number">2.1.</span> <span class="toc-text">Asynchronous Command Line Iterface for Kotlin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Demo-CLI-App"><span class="toc-number">3.</span> <span class="toc-text">Demo CLI App</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Run-the-app"><span class="toc-number">4.</span> <span class="toc-text">Run the app</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://gh.jdoneill.com/2021/06/19/kotlin-cli/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&text=Kotlin CLI"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&title=Kotlin CLI"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&is_video=false&description=Kotlin CLI"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Kotlin CLI&body=Check out this article: http://gh.jdoneill.com/2021/06/19/kotlin-cli/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&title=Kotlin CLI"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&title=Kotlin CLI"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&title=Kotlin CLI"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&title=Kotlin CLI"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&name=Kotlin CLI&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://gh.jdoneill.com/2021/06/19/kotlin-cli/&t=Kotlin CLI"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2022 jdONeill
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/gallery/">Gallery</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
