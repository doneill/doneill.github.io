<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Modern Web mapping platforms have adopted WGS 84 &#x2F; Psuedo Mercator – Spherical Mercator projected coordinate system, or more commonly known as Web Mercator.  When working with most web mapping platfor">
<meta property="og:type" content="article">
<meta property="og:title" content="Spatial References in Mobile APIs">
<meta property="og:url" content="http://gh.jdoneill.com/2019/05/25/spatial-references/index.html">
<meta property="og:site_name" content="jdONeill">
<meta property="og:description" content="Modern Web mapping platforms have adopted WGS 84 &#x2F; Psuedo Mercator – Spherical Mercator projected coordinate system, or more commonly known as Web Mercator.  When working with most web mapping platfor">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-05-25T03:46:25.000Z">
<meta property="article:modified_time" content="2019-12-28T18:37:45.673Z">
<meta property="article:author" content="jdONeill">
<meta property="article:tag" content="arcgis runtime">
<meta property="article:tag" content="google maps">
<meta name="twitter:card" content="summary">
    
    
    <!-- title -->
    <title>Spatial References in Mobile APIs</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- Leaflet -->
    
      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
      <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    
    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
      <link rel="alternate" href="/true" title="jdONeill" type="application/atom+xml" />
    
<meta name="generator" content="Hexo 4.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/gallery/">Gallery</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2019/12/06/kotlin-mulitplatform/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://gh.jdoneill.com/2019/05/25/spatial-references/" target="_blank" rel="noopener"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&text=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&title=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&is_video=false&description=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Spatial References in Mobile APIs&body=Check out this article: http://gh.jdoneill.com/2019/05/25/spatial-references/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&title=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&title=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&title=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&title=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&name=Spatial References in Mobile APIs&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://gh.jdoneill.com/2019/05/25/spatial-references/&t=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Spatial References in Mobile APIs
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">jdONeill</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-05-25T03:46:25.000Z" itemprop="datePublished">2019-05-25</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/arcgis-runtime/" rel="tag">arcgis runtime</a>, <a class="tag-link" href="/tags/google-maps/" rel="tag">google maps</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>Modern Web mapping platforms have adopted <a href="https://en.wikipedia.org/wiki/Web_Mercator_projection" target="_blank" rel="noopener">WGS 84 / Psuedo Mercator – Spherical Mercator</a> projected coordinate system, or more commonly known as Web Mercator.  When working with most web mapping platforms points are in WGS84 and the APIs do the converting behind the scenes when showing the points in an app.  Esri’s ArcGIS Runtime platform does things a little differently, taking the Android API as an example, the spatial reference of an <code>ArcGISMap</code> is based on the first layer added to the map, all subsequent layers are automatically reprojected to the initial layers spatial reference when needed.  </p>
<p>ArcGIS online basemaps are in Web Mercator, like other web mapping platforms, and when added as the first layer in an ArcGIS Runtime application it sets Web Mercator as the spatial reference of the map.  When getting a location represented as a point from the API you will get the coordinates in Web Mercator.  This is different from other mapping APIs.  Taking Google Maps as an example whereby the underlying basemap you see in apps is in Web Mercator when you get a location represented as a point it will return WGS84 coordinates to work with the API.  While in Google Maps the API handles the reprojection for you, the ArcGIS Runtime API requires the developer to handle to reprojection. </p>
<p>The ArcGIS Android API provides a <code>GeometryUtil</code> class that has a bunch of static methods to allow you to manipulate geometries.  One such method for dealing with projections is <code>GeometryUtil.project()</code>. This class becomes quite useful when integrating between APIs that use spatial coordinates. </p>
<p>The ArcGIS Android <code>MapView</code> class can give us the center of the area visible to the user as a point in the spatial reference of the map.  To work with other spatial APIs you can use the <code>GeometryUtil.project()</code> method to convert the point to WGS85.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get the center point of the map</span></span><br><span class="line"><span class="keyword">val</span> centerPnt = mapView.visibleArea.extent.center</span><br><span class="line"><span class="keyword">val</span> centerPntWGS84 = GeometryEngine.project(centerPnt, SpatialReferences.getWgs84())</span><br><span class="line"></span><br><span class="line"><span class="comment">// convert lat/lon as String</span></span><br><span class="line"><span class="keyword">val</span> lat = centerPntWGS84.x.toString()</span><br><span class="line"><span class="keyword">val</span> lon = centerPntWGS84.y.toString()</span><br></pre></td></tr></table></figure>

<p>We can use the resulting String representation of the WGS84 latitude and longitude to send to Google’s place search API to get a list of predictions based on search input and the center of the map representing the location of where to set a radius around which to search:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GET(<span class="meta-string">"api/place/autocomplete/json"</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getPredictions</span><span class="params">(<span class="meta">@Query(<span class="meta-string">"key"</span>)</span> apikey: <span class="type">String</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">                    <span class="meta">@Query(<span class="meta-string">"input"</span>)</span> input: <span class="type">String</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">                    <span class="meta">@Query(<span class="meta-string">"location"</span>)</span> location: <span class="type">String</span>, </span></span></span><br><span class="line"><span class="function"><span class="params">                    <span class="meta">@Query(<span class="meta-string">"radius"</span>)</span> radius: <span class="type">String</span>)</span></span>: Call&lt;Prediction&gt;</span><br></pre></td></tr></table></figure>

<p>The results will be centered around the location you send it instead of null island. </p>
<p>You can also easily convert screen points to map coordinates in both Google and ArcGIS Android APIs, but they are accessed differently.  The Google Maps API for Android provides a <code>Projection.toScreenLocation()</code> method to translate between screen location and geographic coordinates, in the ArcGIS Android API this can be done with <code>MapView.screenToLocation()</code>.  These methods honor the returned point in the projection workflow described above. </p>
<p>Check out the weather-mpp on <a href="https://github.com/doneill/weather-map" target="_blank" rel="noopener">GitHub</a> for a working example of using Google Places API to zoom to a location result from a places search and map it on an ArcGIS Android Basemap.  </p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/gallery/">Gallery</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://gh.jdoneill.com/2019/05/25/spatial-references/" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&text=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&title=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&is_video=false&description=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Spatial References in Mobile APIs&body=Check out this article: http://gh.jdoneill.com/2019/05/25/spatial-references/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&title=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&title=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&title=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&title=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://gh.jdoneill.com/2019/05/25/spatial-references/&name=Spatial References in Mobile APIs&description=" target="_blank" rel="noopener"><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://gh.jdoneill.com/2019/05/25/spatial-references/&t=Spatial References in Mobile APIs" target="_blank" rel="noopener"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 jdONeill
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/gallery/">Gallery</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
